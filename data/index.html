<!DOCTYPE html>
<html>
<head>
  <title>H801</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"> 
<style>
body {
  color: #333333;
  background-color: #416a98;
  font-family:Helvetica, Arial, Sans-Serif;
  font-size:12px;
}
form {
  padding-top: 50px;
  margin: auto; 
  max-width: 400px;
}
div.container {
  background-color: #eaeaea;
  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.2), 0 5px 5px 0 rgba(0, 0, 0, 0.24);
  padding: 15px;
}
div.container > div {
  display: flex;
  height: 35px;
  line-height:35px;
}
label,
span.result {
  display: inline-block;
  font-size: 14px;
  font-weight: bold;
  white-space: pre;
}
label {
  min-width: 40px;
  text-align: right;
}
span.result {
  min-width: 40px;
  text-align: left;
}
input[type=button]:hover {
  background-color: #3b6989;
}
input[type=button] {
  background-color: #5b8dad;
  border: 0;
  color: #ffffff;
  flex-grow: 1;
  margin: 2px 10px;
  padding: 8px 10px;
}

input[type=range],
input[type=number] {
  flex-grow: 1;
  margin: 2px 10px;
}

input[type=range] {
  -webkit-appearance: none;
  margin: 8px 10px;
  width: 100%;
}
input[type=range]:focus {
  outline: none;
}
input[type=range]::-moz-range-track {
  background: transparent;
  cursor: pointer;
  height: 15.3px;
  width: 100%;
}
input[type=range]::-moz-range-thumb {
  background: #000000;
  border: 0;
  cursor: pointer;
  height: 31px;
  width: 3px;
}
input[type=range]::-ms-track {
  background: transparent;
  border-color: transparent;
  color: transparent;
  cursor: pointer;
  height: 15.3px;
  width: 100%;
}
input[type=range]::-ms-fill-lower {
  border-radius: 2.6px;
}
input[type=range]::-ms-fill-upper {
  border-radius: 2.6px;
}
input[type=range]::-ms-thumb {
  border-radius: 3px;
  cursor: pointer;
  height: 15.3px;
  height: 31px;
  width: 3px;
}

#R_val {
  background: linear-gradient(to right, #000, #f00);
}
#G_val {
  background: linear-gradient(to right, #000, #0f0);
}
#B_val {
  background: linear-gradient(to right, #000, #00f);
}
#W1_val {
  background: linear-gradient(to right, #000, #fff);
}
#W2_val {
  background: linear-gradient(to right, #000, #fff);
}
#duration_val {
  background-color: #aaa;
}
</style>
</head>

<body>
<script>
function doPost() {
  var data = {};
  ['R', 'G', 'B', 'W1', 'W2', 'duration'].forEach(function(item) {
    data[item] = document.getElementById(item + '_val').value;
  })

  var request = new XMLHttpRequest();
  request.open('POST', '/status', true);
  request.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8');
  request.error = function() { }
  request.onload = function() { };
  request.send(JSON.stringify(data));
}

function doRefresh() {
  var request = new XMLHttpRequest(); 
  request.open('GET', '/status', true);
  request.error = function() {
  }

  request.onload = function() {
    if (this.status < 200 && this.status >= 400) {
      return;
    }
    var data = JSON.parse(this.response);
    Object.keys(data).forEach(function(prop) {
      var dom = document.getElementById(prop + '_txt');
      if (dom)
        dom.innerHTML = ''+data[prop];
      dom = document.getElementById(prop + '_val');
      // Don't update active slider
      if (dom && dom != document.activeElement)
        dom.value = ''+data[prop];
    });
  };
  request.send();
}

function sliderChange(item) {
  var domValue = document.getElementById(item + '_val');
  var domTxt   = document.getElementById(item + '_txt');
  
  if (!domTxt)
    ; // Ignore
  else if (!domValue)
    domTxt.innerHTML = "N/A ";
  else if (item == 'duration')
    domTxt.innerHTML = parseInt(domValue.value, 10) / 1000;
  else
    domTxt.innerHTML = domValue.value;
}

</script>

<form id="H801">
  <div class="container">
    <div>
      <label>R:</label>
      <input type="range" id="R_val"  min="0" value="0" max="255" step="1" oninput="sliderChange('R');" onchange="sliderChange('R');">
      <span class="result" id="R_txt">0</span>
    </div>
    <div>
      <label>G:</label>
      <input type="range" id="G_val"  min="0" value="0" max="255" step="1" oninput="sliderChange('G');" onchange="sliderChange('G');">
      <span class="result" id="G_txt">0</span>
    </div>
    <div>
      <label>B:</label>
      <input type="range" id="B_val"  min="0" value="0" max="255" step="1" oninput="sliderChange('B');"  onchange="sliderChange('B');">
      <span class="result" id="B_txt">0</span>
    </div>
    <div>
      <label>W1:</label>
      <input type="range" id="W1_val"  min="0" value="0" max="255" step="1" oninput="sliderChange('W1');" onchange="sliderChange('W1');">
      <span class="result" id="W1_txt">0</span>
    </div>
    <div>
      <label>W2:</label>
      <input type="range" id="W2_val"  min="0" value="0" max="255" step="1" oninput="sliderChange('W2');" onchange="sliderChange('W2');">
      <span class="result" id="W2_txt">0</span>
    </div>
    <br>
    <div>
      <label>Fade:</label>
      <input type="range" id="duration_val" min="0" value="0" step="100" max="60000" step="1" oninput="sliderChange('duration');" onchange="sliderChange('duration');">
      <span class="result"><span id="duration_txt">0</span>s</span>
    </div>
    <br>
    <br>
    <div class="buttons">
      <input type="button" onclick="doRefresh()" class="btnRefresh" value="Get Current">
      <input type="button" onclick="doPost()"    class="btnPost" value="Set Values">
    </div>
  </div>
</form>

<script>
  // Update numbers
  sliderChange('R');
  sliderChange('G');
  sliderChange('B');
  sliderChange('W1');
  sliderChange('W2');
  sliderChange('duration');

  // Fetch current values
  setTimeout(doRefresh, 500);
</script>

</body>